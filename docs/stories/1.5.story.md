# Story 1.5: 신규 사용자 온보딩 플로우

## Status

**Ready for Review**

---

## Story

**As a** 신규 가입 사용자,  
**I want** 첫 로그인 후 앱 사용법을 안내받을 수 있는 온보딩 플로우,  
**so that** AI 메모장의 주요 기능을 빠르게 이해하고 첫 메모를 쉽게 작성할 수 있습니다.

---

## Acceptance Criteria

1. 회원가입 또는 첫 로그인 후 자동으로 온보딩 플로우가 시작되어야 한다
2. 온보딩은 3단계 이내로 구성되며, 각 단계는 핵심 기능을 설명해야 한다
3. 사용자는 온보딩을 건너뛸 수 있어야 하며, 나중에 다시 볼 수 있어야 한다
4. 온보딩 완료 시 첫 메모 작성 화면으로 자동 이동해야 한다
5. 온보딩 진행 상태가 표시되어야 하며, 이전/다음 단계로 이동할 수 있어야 한다
6. 온보딩 완료 상태는 사용자 프로필에 저장되어야 한다
7. 온보딩은 모바일과 데스크톱에서 모두 최적화되어야 한다

---

## Tasks / Subtasks

- [ ] Task 1: 온보딩 데이터 모델 설계 (AC: 6)
  - [ ] Drizzle schema에 user_profiles 테이블 추가
  - [ ] `has_completed_onboarding` boolean 필드 추가
  - [ ] 마이그레이션 생성 및 적용

- [ ] Task 2: 온보딩 상태 관리 Server Action (AC: 1, 6)
  - [ ] `app/actions/onboarding.ts` 생성
  - [ ] `getOnboardingStatus` 함수 (현재 사용자 온보딩 완료 여부 확인)
  - [ ] `completeOnboarding` 함수 (온보딩 완료 상태 저장)
  - [ ] `resetOnboarding` 함수 (온보딩 재시작, 설정에서 사용)

- [ ] Task 3: 온보딩 UI 컴포넌트 구현 (AC: 2, 5, 7)
  - [ ] `components/onboarding/OnboardingModal.tsx` 생성
  - [ ] shadcn/ui Dialog 또는 Sheet 컴포넌트 활용
  - [ ] 3단계 온보딩 콘텐츠 구성:
    - [ ] Step 1: 환영 메시지 + AI 메모장 소개
    - [ ] Step 2: 텍스트/음성 메모 작성 방법 안내
    - [ ] Step 3: AI 요약/태깅 기능 소개
  - [ ] 진행 상태 표시 (예: 1/3, 2/3, 3/3 또는 프로그레스 바)
  - [ ] 이전/다음 버튼
  - [ ] 반응형 디자인 (모바일/데스크톱)

- [ ] Task 4: 온보딩 플로우 로직 (AC: 1, 3, 4)
  - [ ] 첫 로그인 감지 로직 구현
  - [ ] 온보딩 완료 여부에 따른 라우팅 처리
  - [ ] "건너뛰기" 버튼 처리
  - [ ] 온보딩 완료 후 첫 메모 작성 페이지로 리다이렉트

- [ ] Task 5: 온보딩 재시작 기능 (AC: 3)
  - [ ] 설정 페이지 또는 도움말 메뉴에 "온보딩 다시 보기" 버튼 추가
  - [ ] `resetOnboarding` 함수 호출

- [ ] Task 6: 에러 핸들링 및 사용자 피드백
  - [ ] 온보딩 상태 저장 실패 시 에러 처리
  - [ ] 네트워크 오류 시 재시도 로직
  - [ ] Toast 알림 통합

- [ ] Task 7: 단위 테스트 작성
  - [ ] OnboardingModal 컴포넌트 렌더링 테스트
  - [ ] 단계 이동 로직 테스트
  - [ ] 건너뛰기 기능 테스트

- [ ] Task 8: 통합 테스트 작성
  - [ ] getOnboardingStatus Server Action 테스트
  - [ ] completeOnboarding Server Action 테스트
  - [ ] 온보딩 완료 후 상태 저장 검증

---

## Dev Notes

### 기술 스택 및 아키텍처 개요
[Source: docs/architecture.md#1-기술-스택]
- **프레임워크:** Next.js (App Router 사용)
- **UI 라이브러리:** shadcn/ui + Tailwind CSS + Radix UI
- **DB/인증:** Supabase (Auth 기능 활용)
- **ORM:** Drizzle ORM (마이그레이션/쿼리)
- **호스팅:** Vercel

### 데이터 모델 설계
[Source: docs/architecture.md#2-데이터-모델]
- 새로운 `user_profiles` 테이블 필요:
  - `user_id` (FK to Supabase Auth users)
  - `has_completed_onboarding` (boolean, default: false)
  - `created_at`, `updated_at`

### 기존 구현 참고사항
[Source: docs/stories/1.1.story.md, 1.2.story.md, 1.4.story.md]
- Supabase 클라이언트 초기화 완료: `lib/supabase/client.ts`, `lib/supabase/server.ts`
- 인증 Server Actions 위치: `app/actions/auth.ts`
- 사용자 정보 가져오기: `app/actions/user.ts` (getUser 함수)
- UI 컴포넌트 위치: `components/` 디렉토리
- Toast 알림: Sonner 사용 (app/layout.tsx에 이미 통합)
- 테스트 프레임워크: Jest + React Testing Library

### 온보딩 플로우 구조
예상 파일 구조:
```
drizzle/
  schema.ts              # user_profiles 테이블 추가
  migrations/            # 마이그레이션 파일
app/
  actions/
    onboarding.ts        # 온보딩 관련 Server Actions
  onboarding/
    page.tsx             # 온보딩 페이지 (선택사항, 모달로 대체 가능)
components/
  onboarding/
    OnboardingModal.tsx  # 온보딩 모달 컴포넌트
    OnboardingStep.tsx   # 개별 단계 컴포넌트 (재사용)
```

### UI/UX 요구사항
[Source: docs/prd.md#4-Target-Users]
- 모바일 우선 사용자 고려 → 반응형 디자인 필수
- Apple/Notion 수준의 직관적인 UX 지향
- 단순하고 깔끔하며 미니멀한 UI
- 온보딩은 3단계 이내로 간결하게

### 온보딩 콘텐츠 가이드
- **Step 1:** "환영합니다! AI 메모장으로 아이디어를 쉽게 기록하고 정리하세요."
- **Step 2:** "텍스트로 입력하거나, 음성으로 빠르게 메모를 작성할 수 있습니다."
- **Step 3:** "AI가 자동으로 요약과 태그를 생성해 메모를 체계적으로 관리합니다."

### 성공 지표
[Source: docs/epics/epic-1-user-authentication.md#성공-지표]
- 온보딩 완료 시간 3분 이내
- 온보딩 완료율 70% 이상 (건너뛰기 제외)

### Testing

#### 테스트 파일 위치
- 단위 테스트: `__tests__/unit/onboarding/` 디렉토리
- 통합 테스트: `__tests__/integration/onboarding/` 디렉토리

#### 테스트 프레임워크
[Source: Story 1.1, 1.2 Implementation]
- Jest + React Testing Library
- 테스트 실행: `pnpm test`
- 기존 테스트 설정 활용: `jest.config.mjs`, `jest.setup.mjs`

#### 테스트 요구사항
- 온보딩 모달 렌더링 및 단계 전환 테스트
- getOnboardingStatus, completeOnboarding Server Action 테스트
- 건너뛰기 및 완료 시나리오 테스트
- 모바일/데스크톱 반응형 테스트 (뷰포트 변경)

#### 테스트 커버리지 목표
- 핵심 비즈니스 로직 100% 커버리지
- UI 컴포넌트 주요 인터랙션 테스트

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-14 | 1.0 | 스토리 초안 생성 | Bob (SM Agent) |

---

## Dev Agent Record

### Agent Model Used

_(구현 시 작성)_

### Debug Log References

_(구현 시 작성)_

### Completion Notes List

_(구현 시 작성)_

### File List

_(구현 시 작성)_

---

## QA Results

_(QA 검토 시 작성)_



