# Story 4.2: λ…ΈνΈ λ‚΄μ© κΈ°λ° μλ™ μ”μ•½ μƒμ„±

## Status

**Ready for Review**

---

## Story

**As a** λ΅κ·ΈμΈν• μ‚¬μ©μ,  
**I want** λ…ΈνΈ μ‘μ„± μ‹ λ‚΄μ©μ„ μλ™μΌλ΅ μ”μ•½,  
**so that** κΈ΄ λ…ΈνΈμ ν•µμ‹¬ λ‚΄μ©μ„ λΉ λ¥΄κ² νμ•…ν•  μ μμµλ‹λ‹¤.

---

## Acceptance Criteria

1. λ…ΈνΈλ¥Ό μƒμ„±ν•κ±°λ‚ μμ •ν•  λ• "AI μ”μ•½ μƒμ„±" λ²„νΌμ΄ ν‘μ‹λμ–΄μ•Ό ν•λ‹¤
2. "AI μ”μ•½ μƒμ„±" λ²„νΌ ν΄λ¦­ μ‹ Gemini APIλ¥Ό νΈμ¶ν•μ—¬ λ…ΈνΈ λ‚΄μ©μ„ μ”μ•½ν•΄μ•Ό ν•λ‹¤
3. μƒμ„±λ μ”μ•½μ€ 3-6κ°μ λ¶λ¦Ώ ν¬μΈνΈ ν•μ‹μ΄μ–΄μ•Ό ν•λ‹¤
4. μ”μ•½μ€ λ°μ΄ν„°λ² μ΄μ¤μ `summaries` ν…μ΄λΈ”μ— μ €μ¥λμ–΄μ•Ό ν•λ‹¤
5. λ…ΈνΈλ‹Ή ν•λ‚μ μ”μ•½λ§ μ €μ¥λμ–΄μ•Ό ν•λ‹¤ (κΈ°μ΅΄ μ”μ•½μ΄ μμΌλ©΄ μ—…λ°μ΄νΈ)
6. μ”μ•½ μƒμ„± μ¤‘ λ΅λ”© μƒνƒλ¥Ό ν‘μ‹ν•΄μ•Ό ν•λ‹¤
7. μ”μ•½ μƒμ„± μ™„λ£ μ‹ μ‚¬μ©μμ—κ² μ„±κ³µ λ©”μ‹μ§€λ¥Ό ν‘μ‹ν•΄μ•Ό ν•λ‹¤
8. μ”μ•½ μƒμ„± μ‹¤ν¨ μ‹ μ‚¬μ©μ μΉν™”μ μΈ μ—λ¬ λ©”μ‹μ§€λ¥Ό ν‘μ‹ν•΄μ•Ό ν•λ‹¤
9. λ…ΈνΈ μƒμ„Έ νμ΄μ§€μ—μ„ μƒμ„±λ μ”μ•½μ„ ν™•μΈν•  μ μμ–΄μ•Ό ν•λ‹¤
10. μ”μ•½μ€ λ…ΈνΈ μ‘μ„±μλ§ μƒμ„±ν•κ³  μ΅°νν•  μ μμ–΄μ•Ό ν•λ‹¤ (μ‚¬μ©μ μ¤μ½”ν”„)
11. λ…ΈνΈ λ‚΄μ©μ΄ λ„λ¬΄ μ§§μ€ κ²½μ° (μ: 50μ λ―Έλ§) μ μ ν• μ•λ‚΄ λ©”μ‹μ§€λ¥Ό ν‘μ‹ν•΄μ•Ό ν•λ‹¤
12. μ”μ•½ μƒμ„± μ‹ μ‚¬μ©λ AI λ¨λΈ μ •λ³΄λ¥Ό ν•¨κ» μ €μ¥ν•΄μ•Ό ν•λ‹¤

---

## Tasks / Subtasks

- [x] Task 1: AI μ”μ•½ μƒμ„± Server Action κµ¬ν„ (AC: 2, 3, 4, 5, 10, 12)
  - [x] `app/actions/summaries.ts` μƒμ„±
  - [x] `generateSummary(noteId: string)` ν•¨μ κµ¬ν„:
    - [x] μ‚¬μ©μ μΈμ¦ ν™•μΈ (Supabase Auth)
    - [x] noteIdλ΅ λ…ΈνΈ μ΅°ν λ° κ¶ν• κ²€μ¦ (μ‚¬μ©μ μ¤μ½”ν”„)
    - [x] λ…ΈνΈ λ‚΄μ© μ ν¨μ„± κ²€μ‚¬ (μµμ† κΈΈμ΄ 50μ)
    - [x] μ”μ•½ μƒμ„± ν”„λ΅¬ν”„νΈ κµ¬μ„± (3-6 λ¶λ¦Ώ ν¬μΈνΈ μ”κµ¬)
    - [x] Gemini API νΈμ¶ (`generateText` ν•¨μ μ‚¬μ©)
    - [x] κΈ°μ΅΄ μ”μ•½ ν™•μΈ (summaries ν…μ΄λΈ” μ΅°ν)
    - [x] κΈ°μ΅΄ μ”μ•½ μμΌλ©΄ UPDATE, μ—†μΌλ©΄ INSERT
    - [x] λ¨λΈ μ •λ³΄ (`gemini-2.0-flash-001`) μ €μ¥
    - [x] μ„±κ³µ/μ‹¤ν¨ μ‘λ‹µ λ°ν™

- [x] Task 2: λ…ΈνΈ μƒμ„Έ νμ΄μ§€μ— μ”μ•½ ν‘μ‹ μ„Ήμ… μ¶”κ°€ (AC: 9)
  - [x] `app/notes/[id]/page.tsx` μμ •
  - [x] λ…ΈνΈ μ΅°ν μ‹ μ”μ•½ λ°μ΄ν„° ν•¨κ» κ°€μ Έμ¤κΈ° (Drizzle relations ν™μ©)
  - [x] μ”μ•½ ν‘μ‹ UI μμ—­ μ¶”κ°€
  - [x] μ”μ•½μ΄ μ—†λ” κ²½μ° "μ”μ•½ μ—†μ" μƒνƒ ν‘μ‹

- [x] Task 3: μ”μ•½ μƒμ„± λ²„νΌ UI μ»΄ν¬λ„νΈ (AC: 1, 6, 7, 8, 11)
  - [x] `components/notes/SummaryGenerateButton.tsx` μƒμ„±
  - [x] Props: `noteId`, `hasExistingSummary`, `onSuccess`
  - [x] "AI μ”μ•½ μƒμ„±" λ²„νΌ
  - [x] λ²„νΌ ν΄λ¦­ μ‹ `generateSummary` Server Action νΈμ¶
  - [x] λ΅λ”© μƒνƒ ν‘μ‹ (μ¤ν”Όλ„ + "μ”μ•½ μƒμ„± μ¤‘...")
  - [x] μ„±κ³µ μ‹ Toast μ•λ¦Ό ("μ”μ•½μ΄ μƒμ„±λμ—μµλ‹λ‹¤")
  - [x] μ‹¤ν¨ μ‹ Toast μ•λ¦Ό (μ—λ¬ λ©”μ‹μ§€)
  - [x] λ…ΈνΈ λ‚΄μ©μ΄ μ§§μ€ κ²½μ° μ•λ‚΄ λ©”μ‹μ§€

- [x] Task 4: μ”μ•½ ν‘μ‹ UI μ»΄ν¬λ„νΈ (AC: 9)
  - [x] `components/notes/SummaryDisplay.tsx` μƒμ„±
  - [x] Props: `summary` (content, model, createdAt)
  - [x] μ”μ•½ λ‚΄μ© ν‘μ‹ (λ§ν¬λ‹¤μ΄ λ¶λ¦Ώ ν¬μΈνΈ λ λ”λ§)
  - [x] μƒμ„± μ‹κ°„ ν‘μ‹ ("5λ¶„ μ „", "1μ‹κ°„ μ „" λ“±)
  - [x] μ‚¬μ©λ AI λ¨λΈ μ •λ³΄ ν‘μ‹ (μ„ νƒ μ‚¬ν•­)
  - [x] μ½κΈ° μΆ‹μ€ μ¤νƒ€μΌλ§ (λ°°κ²½μƒ‰, ν¨λ”© λ“±)

- [x] Task 5: μ”μ•½ μƒμ„± ν”„λ΅¬ν”„νΈ μµμ ν™” (AC: 3)
  - [x] `lib/gemini/prompts.ts` μƒμ„±
  - [x] `createSummaryPrompt(noteContent: string)` ν•¨μ:
    - [x] λ…ν™•ν• μ”μ•½ μ§€μ‹μ‚¬ν•­ ν¬ν•¨
    - [x] 3-6κ° λ¶λ¦Ώ ν¬μΈνΈ μ”κµ¬
    - [x] ν•κµ­μ–΄ μ”μ•½ λ…μ‹
    - [x] ν•µμ‹¬ λ‚΄μ© μ¶”μ¶ κ°•μ΅°
  - [x] ν”„λ΅¬ν”„νΈ ν…ν”λ¦Ώ μ‘μ„±

- [x] Task 6: Drizzle μΏΌλ¦¬ ν—¬νΌ ν•¨μ (AC: 4, 5, 10)
  - [x] Server Actionμ— μ§μ ‘ κµ¬ν„ (λ³„λ„ νμΌ λ¶ν•„μ”)

- [x] Task 7: λ‹¨μ„ ν…μ¤νΈ μ‘μ„±
  - [x] `__tests__/unit/actions/summaries.test.ts`:
    - [x] μ •μƒμ μΈ μ”μ•½ μƒμ„± ν…μ¤νΈ
    - [x] λ…ΈνΈ λ‚΄μ©μ΄ μ§§μ€ κ²½μ° ν…μ¤νΈ
    - [x] κ¶ν• μ—†λ” μ‚¬μ©μ μ ‘κ·Ό ν…μ¤νΈ
    - [x] κΈ°μ΅΄ μ”μ•½ μ—…λ°μ΄νΈ ν…μ¤νΈ
  - [x] `__tests__/unit/notes/SummaryGenerateButton.test.tsx`:
    - [x] λ²„νΌ λ λ”λ§ ν…μ¤νΈ
    - [x] ν΄λ¦­ μ‹ Server Action νΈμ¶ ν…μ¤νΈ
    - [x] λ΅λ”© μƒνƒ ν‘μ‹ ν…μ¤νΈ
  - [x] `__tests__/unit/notes/SummaryDisplay.test.tsx`:
    - [x] μ”μ•½ ν‘μ‹ ν…μ¤νΈ
    - [x] μ‹κ°„ ν¬λ§·ν… ν…μ¤νΈ
  - [x] `__tests__/unit/gemini/prompts.test.ts`:
    - [x] ν”„λ΅¬ν”„νΈ μƒμ„± ν…μ¤νΈ
    - [x] λ…ΈνΈ λ‚΄μ© μλ¥΄κΈ° ν…μ¤νΈ

- [x] Task 8: ν†µν•© ν…μ¤νΈ μ‘μ„± (μ„ νƒ μ‚¬ν•­)
  - [x] μ¤ν‚µ (λ‹¨μ„ ν…μ¤νΈλ΅ μ¶©λ¶„)

---

## Dev Notes

### κΈ°μ  μ¤νƒ λ° μ•„ν‚¤ν…μ² κ°μ”
[Source: docs/architecture.md#1-κΈ°μ -μ¤νƒ]
- **ν”„λ μ„μ›ν¬:** Next.js (App Router, Server Actions)
- **AI λ¨λΈ:** Google Gemini API (gemini-2.0-flash-001)
- **ORM:** Drizzle ORM
- **DB:** Supabase Postgres

### Epic 4 λ©ν‘
[Source: docs/epics/epic-4-ai-summary-tagging.md]
- 3-6κ° λ¶λ¦Ώ ν¬μΈνΈλ΅ κµ¬μ„±λ μ •ν™•ν• μ”μ•½ μ κ³µ
- AI μ²λ¦¬ μ‹κ°„ 10μ΄ μ΄λ‚΄
- μ”μ•½ μ •ν™•λ„ 90% μ΄μƒ (μ‚¬μ©μ λ§μ΅±λ„ κΈ°μ¤€)

### μ΄μ „ μ¤ν† λ¦¬ μ™„λ£ μ‚¬ν•­

**Story 4.1: Gemini API μ„¤μ • λ° μ—°λ™**
[Source: docs/stories/4.1.story.md]
- β… Gemini SDK (`@google/genai`) μ„¤μΉ μ™„λ£
- β… `lib/gemini/client.ts`: Gemini ν΄λΌμ΄μ–ΈνΈ μ΄κΈ°ν™” (μ‹±κΈ€ν†¤)
- β… `lib/gemini/generateText.ts`: ν…μ¤νΈ μƒμ„± ν•¨μ
- β… `lib/utils/aiErrorHandler.ts`: AI μ—λ¬ ν•Έλ“¤λ¬
- β… `lib/types/ai.ts`: AI μ—λ¬ νƒ€μ… μ •μ
- β… κΈ°λ³Έ λ¨λΈ: `gemini-2.0-flash-001`
- β… νƒ€μ„μ•„μ›ƒ: 10μ΄
- β… ν† ν° μ ν•: maxOutputTokens 8192

### λ°μ΄ν„°λ² μ΄μ¤ μ¤ν‚¤λ§

**summaries ν…μ΄λΈ”**
[Source: drizzle/schema.ts]
```typescript
export const summaries = pgTable('summaries', {
  id: uuid('id').defaultRandom().primaryKey(),
  noteId: uuid('note_id').notNull().references(() => notes.id, { onDelete: 'cascade' }).unique(),
  model: varchar('model', { length: 100 }).notNull(), // "gemini-2.0-flash-001"
  content: text('content').notNull(), // μ”μ•½ λ‚΄μ© (3-6 λ¶λ¦Ώ ν¬μΈνΈ)
  createdAt: timestamp('created_at').notNull().defaultNow(),
})
```

**μ£Όμ” νΉμ§•:**
- `noteId`μ— UNIQUE μ μ•½μ΅°κ±΄: λ…ΈνΈλ‹Ή ν•λ‚μ μ”μ•½λ§ ν—μ©
- `onDelete: 'cascade'`: λ…ΈνΈ μ‚­μ  μ‹ μ”μ•½λ„ μλ™ μ‚­μ 
- `model` ν•„λ“: μ‚¬μ©λ AI λ¨λΈ μ •λ³΄ μ €μ¥

**λ…ΈνΈ κ΄€κ³„:**
```typescript
export const notesRelations = relations(notes, ({ one }) => ({
  summary: one(summaries, {
    fields: [notes.id],
    references: [summaries.noteId],
  }),
}))
```

### Server Action ν¨ν„΄

**κΈ°μ΅΄ λ…ΈνΈ κ΄€λ ¨ Server Actions**
[Source: app/actions/notes.ts]
```typescript
// ν‘μ¤€ ν¨ν„΄:
export async function actionName(params): Promise<{
  success: boolean
  data?: ReturnType
  error?: string
}> {
  try {
    // 1. μ‚¬μ©μ μΈμ¦ ν™•μΈ
    const supabase = await createClient()
    const { data: { user }, error: authError } = await supabase.auth.getUser()
    
    if (authError || !user) {
      return { success: false, error: 'λ΅κ·ΈμΈμ΄ ν•„μ”ν•©λ‹λ‹¤.' }
    }
    
    // 2. μ…λ ¥κ°’ μ ν¨μ„± κ²€μ‚¬
    // 3. κ¶ν• κ²€μ¦ (μ‚¬μ©μ μ¤μ½”ν”„)
    // 4. λΉ„μ¦λ‹μ¤ λ΅μ§ μ‹¤ν–‰
    // 5. DB μ‘μ—…
    // 6. μ„±κ³µ μ‘λ‹µ λ°ν™
    
    return { success: true, data: result }
  } catch (error) {
    console.error('Error:', error)
    return { success: false, error: 'μ²λ¦¬ μ‹¤ν¨' }
  }
}
```

### AI μ”μ•½ μƒμ„± ν”„λ΅¬ν”„νΈ μ„¤κ³„

**μ”κµ¬μ‚¬ν•­:**
- 3-6κ°μ λ¶λ¦Ώ ν¬μΈνΈ
- ν•κµ­μ–΄λ΅ μ‘μ„±
- ν•µμ‹¬ λ‚΄μ© μ¶”μ¶
- κ°„κ²°ν•κ³  λ…ν™•ν• ν‘ν„

**ν”„λ΅¬ν”„νΈ μμ‹:**
```typescript
export function createSummaryPrompt(noteContent: string): string {
  return `λ‹¤μ λ…ΈνΈ λ‚΄μ©μ„ 3-6κ°μ λ¶λ¦Ώ ν¬μΈνΈλ΅ μ”μ•½ν•΄μ£Όμ„Έμ”.

μ”μ•½ κ·μΉ™:
- λ°λ“μ‹ 3κ° μ΄μƒ, 6κ° μ΄ν•μ λ¶λ¦Ώ ν¬μΈνΈλ΅ μ‘μ„±
- κ° λ¶λ¦Ώ ν¬μΈνΈλ” ν• λ¬Έμ¥μΌλ΅ κ°„κ²°ν•κ²
- ν•µμ‹¬ λ‚΄μ©κ³Ό μ¤‘μ”ν• μ •λ³΄ μ¤‘μ‹¬μΌλ΅ μ¶”μ¶
- λ¶λ¦Ώ ν¬μΈνΈ ν•μ‹: "- λ‚΄μ©"
- ν•κµ­μ–΄λ΅ μ‘μ„±

λ…ΈνΈ λ‚΄μ©:
${noteContent}

μ”μ•½:`
}
```

### Gemini API νΈμ¶ λ°©λ²•

**κΈ°μ΅΄ μ ν‹Έλ¦¬ν‹° ν™μ©:**
[Source: lib/gemini/generateText.ts]
```typescript
import { generateText } from '@/lib/gemini/generateText'

const result = await generateText(prompt)

if (result.success && result.text) {
  // μ”μ•½ ν…μ¤νΈ μ‚¬μ©
  const summary = result.text
} else {
  // μ—λ¬ μ²λ¦¬
  const errorMessage = result.error
}
```

### Drizzle ORM μΏΌλ¦¬ ν¨ν„΄

**μ”μ•½ μ΅°ν:**
```typescript
import { db } from '@/lib/db'
import { summaries } from '@/drizzle/schema'
import { eq } from 'drizzle-orm'

// κΈ°μ΅΄ μ”μ•½ ν™•μΈ
const [existingSummary] = await db
  .select()
  .from(summaries)
  .where(eq(summaries.noteId, noteId))
  .limit(1)
```

**μ”μ•½ μƒμ„± (INSERT):**
```typescript
const [newSummary] = await db
  .insert(summaries)
  .values({
    noteId,
    model: 'gemini-2.0-flash-001',
    content: summaryText,
  })
  .returning()
```

**μ”μ•½ μ—…λ°μ΄νΈ (UPDATE):**
```typescript
const [updatedSummary] = await db
  .update(summaries)
  .set({
    content: summaryText,
    model: 'gemini-2.0-flash-001',
  })
  .where(eq(summaries.noteId, noteId))
  .returning()
```

**λ…ΈνΈμ™€ μ”μ•½ ν•¨κ» μ΅°ν (Relations):**
```typescript
import { notes, summaries } from '@/drizzle/schema'

const noteWithSummary = await db.query.notes.findFirst({
  where: eq(notes.id, noteId),
  with: {
    summary: true, // κ΄€κ³„ μ •μλ μ”μ•½ ν¬ν•¨
  },
})
```

### κ¶ν• μ¤μ½”ν”„ κ²€μ¦

**λ…ΈνΈ μ†μ μ ν™•μΈ ν¨ν„΄:**
[Source: app/actions/notes.ts]
```typescript
// λ…ΈνΈ μ΅°ν μ‹ μ‚¬μ©μ μ¤μ½”ν”„ κ°•μ 
const [note] = await db
  .select()
  .from(notes)
  .where(and(
    eq(notes.id, noteId),
    eq(notes.userId, user.id) // μ†μ μλ§ μ ‘κ·Ό κ°€λ¥
  ))
  .limit(1)

if (!note) {
  return { success: false, error: 'λ…ΈνΈλ¥Ό μ°Ύμ„ μ μ—†μµλ‹λ‹¤.' }
}
```

### νμΌ κµ¬μ΅°

```
app/
  actions/
    summaries.ts            # (μ‹ κ·) μ”μ•½ μƒμ„± Server Action
  notes/
    [id]/
      page.tsx              # (μμ •) μ”μ•½ ν‘μ‹ μ¶”κ°€
lib/
  gemini/
    prompts.ts              # (μ‹ κ·) AI ν”„λ΅¬ν”„νΈ ν…ν”λ¦Ώ
  db/
    summaries.ts            # (μ‹ κ·, μ„ νƒ) μ”μ•½ μΏΌλ¦¬ ν—¬νΌ
components/
  notes/
    SummaryGenerateButton.tsx  # (μ‹ κ·) μ”μ•½ μƒμ„± λ²„νΌ
    SummaryDisplay.tsx         # (μ‹ κ·) μ”μ•½ ν‘μ‹
__tests__/
  unit/
    actions/
      summaries.test.ts     # (μ‹ κ·) Server Action ν…μ¤νΈ
    notes/
      SummaryGenerateButton.test.tsx  # (μ‹ κ·)
      SummaryDisplay.test.tsx         # (μ‹ κ·)
  integration/
    summaries/
      generate-summary.test.ts  # (μ‹ κ·, μ„ νƒ)
```

### UI/UX κ³ λ ¤μ‚¬ν•­

**μ”μ•½ μƒμ„± λ²„νΌ μ„μΉ:**
- λ…ΈνΈ μƒμ„Έ νμ΄μ§€: μ λ©/λ³Έλ¬Έ ν•λ‹¨
- λ…ΈνΈ μμ • νμ΄μ§€: μ €μ¥ λ²„νΌ κ·Όμ²

**λ΅λ”© μƒνƒ:**
- λ²„νΌ λΉ„ν™μ„±ν™”
- μ¤ν”Όλ„ μ•„μ΄μ½ ν‘μ‹
- "μ”μ•½ μƒμ„± μ¤‘..." ν…μ¤νΈ

**μ—λ¬ μ²λ¦¬:**
- λ…ΈνΈ λ‚΄μ©μ΄ μ§§μ€ κ²½μ°: "λ…ΈνΈ λ‚΄μ©μ΄ λ„λ¬΄ μ§§μµλ‹λ‹¤. μµμ† 50μ μ΄μƒ μ‘μ„±ν•΄μ£Όμ„Έμ”."
- AI μ²λ¦¬ μ‹¤ν¨: "μ”μ•½ μƒμ„±μ— μ‹¤ν¨ν–μµλ‹λ‹¤. λ‹¤μ‹ μ‹λ„ν•΄μ£Όμ„Έμ”."
- νƒ€μ„μ•„μ›ƒ: "AI μ²λ¦¬ μ‹κ°„μ΄ μ΄κ³Όλμ—μµλ‹λ‹¤. λ‹¤μ‹ μ‹λ„ν•΄μ£Όμ„Έμ”."

**μ”μ•½ ν‘μ‹ μ¤νƒ€μΌ:**
- λ°°κ²½μƒ‰: μ—°ν• νλ€μƒ‰ λλ” νμƒ‰
- ν¨λ”©: μ μ ν• μ—¬λ°±
- λ¶λ¦Ώ ν¬μΈνΈ: λ©λ΅ ν•μ‹μΌλ΅ λ…ν™•ν•κ²
- νƒ€μ΄ν‹€: "π“ AI μ”μ•½" λλ” "β¨ μ”μ•½"

### λ³΄μ• κ³ λ ¤μ‚¬ν•­
[Source: docs/architecture.md#3-λ³΄μ•]
- Gemini API νΈμ¶μ€ μ„λ²„μ—μ„λ§ (Server Action)
- μ”μ•½ μ΅°ν μ‹ λ…ΈνΈ μ†μ μ κ²€μ¦ ν•„μ
- μ‚¬μ©μ μ¤μ½”ν”„: notes.userId = user.id
- API ν‚¤λ” ν™κ²½ λ³€μλ΅ κ΄€λ¦¬ (ν΄λΌμ΄μ–ΈνΈ λ…Έμ¶ κΈμ§€)

### μ„±λ¥ μµμ ν™”

**ν† ν° μ ν•:**
- λ…ΈνΈ λ‚΄μ©μ΄ λ§¤μ° κΈ΄ κ²½μ° (μ: 10,000μ μ΄μƒ) μλΌλ‚΄κΈ° κ³ λ ¤
- maxOutputTokens: 8192 (Story 4.1μ—μ„ μ„¤μ •λ¨)

**μΊμ‹±:**
- λ…ΈνΈ λ‚΄μ©μ΄ λ³€κ²½λμ§€ μ•μ•μΌλ©΄ μ¬μƒμ„± λ¶ν•„μ”
- κΈ°μ΅΄ μ”μ•½ μ¬μ‚¬μ©

**λΉ„λ™κΈ° μ²λ¦¬:**
- μ”μ•½ μƒμ„±μ€ λΉ„λ™κΈ°λ΅ μ²λ¦¬
- μ‚¬μ©μλ” λ΅λ”© μƒνƒ ν™•μΈ κ°€λ¥

### Testing

**ν…μ¤νΈ ν”„λ μ„μ›ν¬:**
[Source: Epic 2 - κΈ°μ μ  μ”κµ¬μ‚¬ν•­]
- **Framework:** Jest + React Testing Library
- **μ‹¤ν–‰:** `pnpm test`
- **μ„μΉ:** `__tests__/unit/`, `__tests__/integration/`

**λ‹¨μ„ ν…μ¤νΈ μ”κµ¬μ‚¬ν•­:**
- Server Action λ¨ν‚Ή (Supabase, Drizzle, Gemini API)
- μ»΄ν¬λ„νΈ λ λ”λ§ λ° μΈν„°λ™μ… ν…μ¤νΈ
- μ—λ¬ μ‹λ‚λ¦¬μ¤ κ²€μ¦

**ν†µν•© ν…μ¤νΈ (μ„ νƒ):**
- End-to-end ν”λ΅μ° κ²€μ¦
- μ‹¤μ  DB μ‘μ—… ν™•μΈ (ν…μ¤νΈ DB μ‚¬μ©)

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-14 | 1.0 | μ¤ν† λ¦¬ μ΄μ• μƒμ„± | Bob (SM Agent) |
| 2025-10-14 | 2.0 | μ¤ν† λ¦¬ κµ¬ν„ μ™„λ£ (λ¨λ“  Task μ™„λ£, 29κ° ν…μ¤νΈ ν†µκ³Ό) | James (Dev Agent) |

---

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4.5

### Debug Log References

- ν…μ¤νΈ μ‹¤ν¨ (summaries.test.ts): λ…ΈνΈ λ‚΄μ©μ΄ 50μ λ―Έλ§μΌλ΅ μ ν¨μ„± κ²€μ‚¬ μ‹¤ν¨ β†’ ν…μ¤νΈ λ°μ΄ν„° μμ •
- Jest ES λ¨λ“ μ—λ¬ (@google/genai): `jest.mock`μΌλ΅ `lib/gemini/client.ts` λ¨ν‚Ήν•μ—¬ ν•΄κ²°

### Completion Notes List

1. **AI μ”μ•½ μƒμ„± Server Action κµ¬ν„ μ™„λ£**
   - `generateSummary`: λ…ΈνΈ λ‚΄μ© κΈ°λ° μ”μ•½ μƒμ„± (INSERT/UPDATE)
   - `getSummary`: λ…ΈνΈμ μ”μ•½ μ΅°ν
   - μµμ† κΈΈμ΄ κ²€μ¦ (50μ), μ‚¬μ©μ μ¤μ½”ν”„ κ²€μ¦, μ—λ¬ ν•Έλ“¤λ§

2. **ν”„λ΅¬ν”„νΈ μµμ ν™”**
   - `createSummaryPrompt`: 3-6κ° λ¶λ¦Ώ ν¬μΈνΈ μƒμ„± ν”„λ΅¬ν”„νΈ
   - `truncateNoteContent`: κΈ΄ λ…ΈνΈ λ‚΄μ© μλ¥΄κΈ° (8000μ μ ν•)

3. **UI μ»΄ν¬λ„νΈ κµ¬ν„ μ™„λ£**
   - `SummaryDisplay`: μ”μ•½ λ‚΄μ© ν‘μ‹ (λ¶λ¦Ώ ν¬μΈνΈ, μ‹κ°„, λ¨λΈ μ •λ³΄)
   - `SummaryGenerateButton`: μ”μ•½ μƒμ„±/μ¬μƒμ„± λ²„νΌ (λ΅λ”©, Toast μ•λ¦Ό)
   - `SummarySection`: μ”μ•½ μ„Ήμ… μ»¨ν…μ΄λ„ (λΉ μƒνƒ μ²λ¦¬)

4. **λ…ΈνΈ μƒμ„Έ νμ΄μ§€ μμ •**
   - `getNoteById`: Drizzle relationsλ΅ μ”μ•½ λ°μ΄ν„° ν•¨κ» μ΅°ν
   - `app/notes/[id]/page.tsx`: μ”μ•½ μ„Ήμ… μ¶”κ°€

5. **λ‹¨μ„ ν…μ¤νΈ μ™„λ£ (29κ° ν…μ¤νΈ ν†µκ³Ό)**
   - Server Actions, UI μ»΄ν¬λ„νΈ, ν”„λ΅¬ν”„νΈ μ ν‹Έλ¦¬ν‹° κ²€μ¦
   - λ¨λ“  AC μ¶©μ΅± ν™•μΈ

### File List

**μƒμ„±λ νμΌ:**
- `lib/gemini/prompts.ts`: μ”μ•½ ν”„λ΅¬ν”„νΈ ν…ν”λ¦Ώ
- `app/actions/summaries.ts`: μ”μ•½ μƒμ„±/μ΅°ν Server Actions
- `components/notes/SummaryDisplay.tsx`: μ”μ•½ ν‘μ‹ UI
- `components/notes/SummaryGenerateButton.tsx`: μ”μ•½ μƒμ„± λ²„νΌ UI
- `components/notes/SummarySection.tsx`: μ”μ•½ μ„Ήμ… μ»¨ν…μ΄λ„
- `__tests__/unit/actions/summaries.test.ts`: Server Actions ν…μ¤νΈ
- `__tests__/unit/notes/SummaryGenerateButton.test.tsx`: λ²„νΌ μ»΄ν¬λ„νΈ ν…μ¤νΈ
- `__tests__/unit/notes/SummaryDisplay.test.tsx`: ν‘μ‹ μ»΄ν¬λ„νΈ ν…μ¤νΈ
- `__tests__/unit/gemini/prompts.test.ts`: ν”„λ΅¬ν”„νΈ μ ν‹Έλ¦¬ν‹° ν…μ¤νΈ

**μμ •λ νμΌ:**
- `app/actions/notes.ts`: `getNoteById`μ— μ”μ•½ λ°μ΄ν„° ν¬ν•¨ (Drizzle relations ν™μ©)
- `app/notes/[id]/page.tsx`: μ”μ•½ μ„Ήμ… μ¶”κ°€

---

## QA Results

_(QA κ²€ν†  μ‹ μ‘μ„±)_

