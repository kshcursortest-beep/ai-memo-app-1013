# Story 4.4: AI 처리 상태 표시 (로딩, 완료, 에러)

## Status
Ready for Review

## Story
**As a** 사용자,
**I want** AI 요약/태그 생성 과정의 상태를 명확하게 볼 수 있도록,
**so that** 처리 진행 상황을 파악하고 적절한 조치를 취할 수 있다

## Acceptance Criteria
1. AI 요약 생성 시 로딩 상태가 명확하게 표시된다
2. AI 태그 생성 시 로딩 상태가 명확하게 표시된다
3. AI 처리 완료 시 성공 상태가 표시된다
4. AI 처리 실패 시 에러 상태와 재시도 옵션이 표시된다
5. 로딩 중에는 사용자가 다른 작업을 할 수 있도록 UI가 적절히 비활성화된다
6. 에러 발생 시 사용자에게 친화적인 메시지가 표시된다
7. 네트워크 오류와 AI API 오류를 구분하여 표시한다
8. 처리 시간이 길어질 경우 진행률 표시가 제공된다

## Tasks / Subtasks
- [x] AI 처리 상태 관리 시스템 구현 (AC: 1, 2, 3, 4)
  - [x] 로딩, 완료, 에러 상태 타입 정의
  - [x] 상태 전환 로직 구현
  - [x] 상태별 UI 컴포넌트 생성
- [x] 로딩 상태 UI 구현 (AC: 1, 2, 5)
  - [x] 스피너/프로그레스 바 컴포넌트
  - [x] 로딩 중 버튼 비활성화
  - [x] 로딩 메시지 표시
- [x] 에러 상태 UI 구현 (AC: 4, 6, 7)
  - [x] 에러 타입별 메시지 정의
  - [x] 재시도 버튼 구현
  - [x] 에러 상세 정보 표시
- [x] 진행률 표시 구현 (AC: 8)
  - [x] 처리 단계별 진행률 표시
  - [x] 예상 소요 시간 표시
- [x] 상태 표시 통합 (AC: 1-8)
  - [x] 요약 생성 컴포넌트에 상태 표시 적용
  - [x] 태그 생성 컴포넌트에 상태 표시 적용
  - [x] 임시 태그 생성 컴포넌트에 상태 표시 적용

## Dev Notes

### 이전 스토리에서의 인사이트
- Story 4.2 (요약 생성): AI 요약 생성 시 로딩 상태가 없어 사용자 경험이 부족함
- Story 4.3 (태그 생성): 태그 생성 중 사용자 피드백이 부족하여 재시도 여부를 판단하기 어려움
- AI API 호출 시 네트워크 지연과 API 오류를 구분하여 처리해야 함

### 데이터 모델
- AI 처리 상태: `loading` | `success` | `error` | `idle`
- 에러 타입: `network` | `api` | `validation` | `timeout`
- 진행률: 0-100% 단계별 표시

### API 명세
- 기존 Server Actions (`generateSummary`, `generateTags`, `generateTempTags`)에 상태 반환 추가
- 에러 타입별 상세 정보 제공
- 처리 단계별 진행률 정보 제공

### 컴포넌트 명세
- `LoadingSpinner`: 기본 로딩 표시
- `ProgressBar`: 진행률 표시
- `ErrorMessage`: 에러 상태 표시
- `RetryButton`: 재시도 기능
- 상태 표시를 위한 기존 컴포넌트 수정

### 파일 위치
- `lib/types/ai.ts`: AI 상태 타입 정의
- `components/ui/loading.tsx`: 로딩 관련 UI 컴포넌트
- `components/ui/error.tsx`: 에러 관련 UI 컴포넌트
- `components/notes/SummarySection.tsx`: 요약 상태 표시 적용
- `components/notes/TagSection.tsx`: 태그 상태 표시 적용
- `components/notes/TempTagGenerator.tsx`: 임시 태그 상태 표시 적용

### 테스트 요구사항
- 각 상태별 UI 렌더링 테스트
- 상태 전환 로직 테스트
- 에러 처리 시나리오 테스트
- 사용자 인터랙션 테스트

### 기술적 제약사항
- Next.js App Router 환경에서의 상태 관리
- Server Actions의 비동기 처리 상태 표시
- 클라이언트-서버 간 상태 동기화
- 접근성(a11y) 고려한 상태 표시

## Testing

### 테스트 파일 위치
- `__tests__/unit/components/ui/loading.test.tsx`
- `__tests__/unit/components/ui/error.test.tsx`
- `__tests__/unit/components/notes/SummarySection.test.tsx`
- `__tests__/unit/components/notes/TagSection.test.tsx`
- `__tests__/unit/components/notes/TempTagGenerator.test.tsx`
- `__tests__/integration/ai-status-display.test.ts`

### 테스트 표준
- Jest + React Testing Library 사용
- 각 상태별 컴포넌트 렌더링 테스트
- 사용자 인터랙션 시뮬레이션
- 에러 시나리오 모킹
- 접근성 테스트 포함

### 특정 테스트 요구사항
- 로딩 상태에서 버튼 비활성화 확인
- 에러 발생 시 재시도 버튼 동작 확인
- 네트워크 오류와 API 오류 구분 표시 확인
- 진행률 표시 정확성 확인

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-19 | 1.0 | 초기 스토리 문서 생성 | Scrum Master |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4 (2024-12-19)

### Debug Log References
- 로딩 컴포넌트 테스트 실패: Progress 컴포넌트 순환 참조 문제 해결
- 에러 컴포넌트 테스트 실패: aria-label 및 data-testid 추가로 해결
- Server Actions 상태 반환: AIError 타입 추가 및 에러 처리 개선

### Completion Notes List
- AI 상태 타입 시스템 완전 구현 (idle, loading, success, error)
- 로딩, 에러, 진행률 UI 컴포넌트 모두 구현 완료
- SummarySection, TagSection, TempTagGenerator에 상태 표시 통합
- Server Actions에 AIError 반환 기능 추가
- 단위 테스트 및 통합 테스트 모두 통과

### File List
**새로 생성된 파일:**
- `lib/types/ai.ts` - AI 상태 및 에러 타입 정의
- `components/ui/loading.tsx` - 로딩 상태 UI 컴포넌트
- `components/ui/error.tsx` - 에러 상태 UI 컴포넌트
- `components/ui/progress.tsx` - 진행률 표시 UI 컴포넌트
- `__tests__/unit/components/ui/loading.test.tsx` - 로딩 컴포넌트 테스트
- `__tests__/unit/components/ui/error.test.tsx` - 에러 컴포넌트 테스트
- `__tests__/integration/ai-status-display.test.ts` - 통합 테스트

**수정된 파일:**
- `app/actions/summaries.ts` - AIError 반환 추가
- `app/actions/tags.ts` - AIError 반환 추가
- `components/notes/SummarySection.tsx` - 상태 표시 통합
- `components/notes/SummaryGenerateButton.tsx` - 상태 콜백 지원
- `components/notes/TagSection.tsx` - 상태 표시 통합
- `components/notes/TagGenerator.tsx` - 상태 콜백 지원
- `components/notes/TempTagGenerator.tsx` - 상태 표시 통합

## QA Results
*QA 에이전트가 검토 시 기록*
