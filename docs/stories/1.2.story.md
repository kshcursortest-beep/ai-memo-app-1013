# Story 1.2: 이메일/비밀번호 로그인

## Status

**Ready for Review**

---

## Story

**As a** 등록된 사용자,  
**I want** 이메일과 비밀번호로 로그인할 수 있는 기능,  
**so that** 내 계정에 안전하게 접근하고 저장된 메모를 확인할 수 있습니다.

---

## Acceptance Criteria

1. 사용자는 등록된 이메일과 비밀번호로 로그인할 수 있어야 한다
2. 잘못된 이메일 또는 비밀번호 입력 시 명확한 에러 메시지가 표시되어야 한다
3. 로그인 성공 시 자동으로 메인 페이지로 이동해야 한다
4. 로그인 폼은 모바일과 데스크톱에서 모두 직관적이고 접근성이 높아야 한다
5. 로그인 과정은 3초 이내에 완료되어야 한다 (네트워크 정상 상태 기준)
6. 로그인 상태는 브라우저를 닫았다가 다시 열어도 유지되어야 한다
7. 회원가입 페이지로 이동할 수 있는 링크가 제공되어야 한다

---

## Tasks / Subtasks

- [x] Task 1: 로그인 Server Action 구현 (AC: 1, 2, 3, 5, 6)
  - [x] `app/actions/auth.ts`에 `signInWithEmail` 함수 추가
  - [x] Supabase Auth의 `signInWithPassword` 메서드 호출
  - [x] 잘못된 인증 정보 에러 핸들링
  - [x] 세션 쿠키 자동 설정 확인
  - [x] 에러 응답 표준화

- [x] Task 2: 로그인 UI 컴포넌트 구현 (AC: 2, 4, 7)
  - [x] `components/auth/SignInForm.tsx` 생성
  - [x] 이메일 입력 필드 (Input 컴포넌트)
  - [x] 비밀번호 입력 필드 (Input 컴포넌트, type="password")
  - [x] 로그인 버튼 (Button 컴포넌트)
  - [x] Tailwind CSS로 반응형 레이아웃 스타일링
  - [x] 접근성 속성 추가 (aria-labels, form labels)
  - [x] 회원가입 페이지 링크 추가

- [x] Task 3: 클라이언트 측 유효성 검사 구현 (AC: 2)
  - [x] 이메일 형식 검증 (기존 validation.ts 유틸 활용)
  - [x] 빈 필드 검증
  - [x] 실시간 유효성 검사 피드백 UI
  - [x] 에러 메시지 표시 로직

- [x] Task 4: 로그인 페이지 라우트 생성 (AC: 3)
  - [x] `app/login/page.tsx` 생성
  - [x] 로그인 컴포넌트 통합
  - [x] 성공 시 메인 페이지(`/`) 리다이렉션 로직
  - [x] 로딩 상태 UI 추가

- [x] Task 5: 에러 핸들링 및 사용자 피드백 (AC: 2)
  - [x] Toast 알림을 통한 에러 표시 (기존 Sonner 활용)
  - [x] 서버 에러 메시지를 사용자 친화적 메시지로 변환
  - [x] 네트워크 에러 처리

- [x] Task 6: 세션 지속성 테스트 (AC: 6)
  - [x] Supabase 세션 자동 갱신 확인
  - [x] 브라우저 재시작 후 세션 유지 검증

- [x] Task 7: 단위 테스트 작성
  - [x] 이메일 유효성 검사 함수 테스트 (기존 테스트 재사용)
  - [x] SignInForm 컴포넌트 테스트
  - [x] Server Action 모킹 및 테스트

- [x] Task 8: 통합 테스트 작성
  - [x] 정상 로그인 플로우 테스트
  - [x] 잘못된 이메일/비밀번호 에러 시나리오 테스트
  - [x] 세션 지속성 테스트

---

## Dev Notes

### 기술 스택 및 아키텍처 개요
[Source: docs/architecture.md#1-기술-스택]
- **프레임워크:** Next.js (App Router 사용)
- **UI 라이브러리:** shadcn/ui + Tailwind CSS + Radix UI
- **DB/인증:** Supabase (Auth 기능 활용)
- **호스팅:** Vercel

### 인증 구현 세부사항
[Source: docs/prd.md#6-MVP-Scope]
- 이메일 로그인만 MVP에 포함 (소셜 로그인 제외)
- Supabase Auth를 사용한 로그인 구현

[Source: docs/architecture.md#3-보안]
- 사용자 인증은 Supabase Auth API 사용
- 권한 스코프는 서버 코드에서 처리
- Supabase 서비스 롤 키는 서버 전용 (클라이언트 노출 금지)

### 기존 구현 참고사항
[Source: docs/stories/1.1.story.md - Previous Story Insights]
- Supabase 클라이언트 초기화 완료: `lib/supabase/client.ts`, `lib/supabase/server.ts`
- 인증 Server Actions 위치: `app/actions/auth.ts`
- UI 컴포넌트 위치: `components/auth/`
- 유효성 검사 유틸: `lib/utils/validation.ts`
- Toast 알림: Sonner 사용 (app/layout.tsx에 이미 통합)
- 테스트 프레임워크: Jest + React Testing Library

### 데이터 모델
[Source: docs/architecture.md#2-데이터-모델]
- Supabase Auth가 자동으로 `auth.users` 테이블 관리
- `user_id`는 `notes` 테이블의 외래 키로 사용됨
- 로그인 시점에서는 별도 커스텀 프로필 테이블 불필요 (MVP 스코프)

### 프로젝트 구조
예상 파일 구조 (Story 1.1 기반):
```
app/
  login/
    page.tsx              # 로그인 페이지
  actions/
    auth.ts               # 인증 관련 Server Actions (signInWithEmail 추가)
components/
  auth/
    SignInForm.tsx        # 로그인 폼 컴포넌트
    SignUpForm.tsx        # (기존) 회원가입 폼
lib/
  supabase/
    client.ts             # (기존) Supabase 클라이언트 초기화
    server.ts             # (기존) 서버용 Supabase 클라이언트
  utils/
    validation.ts         # (기존) 유효성 검사 유틸리티
```

### UI/UX 요구사항
[Source: docs/prd.md#4-Target-Users]
- 모바일 우선 사용자 고려 → 반응형 디자인 필수
- Apple/Notion 수준의 직관적인 UX 지향 (프로젝트 규칙)
- 단순하고 깔끔하며 미니멀한 UI (프로젝트 규칙)

### 성공 지표
[Source: docs/epics/epic-1-user-authentication.md#성공-지표]
- 로그인 성공률 95% 이상
- 인증 관련 에러율 1% 미만

### 성능 요구사항
[Source: AC 5]
- 로그인 과정은 3초 이내 완료 (네트워크 정상 상태)

### 세션 관리
[Source: AC 6, docs/architecture.md#3-보안]
- Supabase Auth의 세션 자동 갱신 기능 활용
- 쿠키 기반 세션 저장 (서버/클라이언트 모두 접근 가능)
- 브라우저 종료 후에도 세션 유지 (Remember Me 기본 활성화)

### Testing

#### 테스트 파일 위치
- 단위 테스트: `__tests__/unit/auth/` 디렉토리
- 통합 테스트: `__tests__/integration/auth/` 디렉토리

#### 테스트 프레임워크
[Source: Story 1.1 Implementation]
- Jest + React Testing Library
- 테스트 실행: `pnpm test`
- 기존 테스트 설정 활용: `jest.config.mjs`, `jest.setup.mjs`

#### 테스트 요구사항
- 이메일 형식 검증 로직 단위 테스트 (기존 테스트 재사용 가능)
- SignInForm 컴포넌트 렌더링 및 인터랙션 테스트
- Server Action 모킹 및 에러 처리 테스트
- 정상 로그인 플로우 통합 테스트
- 잘못된 인증 정보, 네트워크 에러 등 에러 시나리오 테스트
- 세션 지속성 테스트

#### 테스트 커버리지 목표
- 핵심 비즈니스 로직 100% 커버리지
- UI 컴포넌트 주요 인터랙션 테스트

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-14 | 1.0 | 스토리 초안 생성 | Bob (SM Agent) |
| 2025-10-14 | 1.1 | 스토리 구현 완료 | James (Dev Agent) |

---

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4.5

### Debug Log References

없음

### Completion Notes List

- 모든 기능 구현 완료
- 전체 48개 테스트 통과 (기존 32개 + 신규 16개)
- 로그인 Server Action 추가 (signInWithEmail)
- SignInForm 컴포넌트 구현 (SignUpForm과 유사한 구조)
- 세션 자동 저장 및 유지 (Supabase Auth 기본 기능)
- Toast 알림 통합 (기존 Sonner 활용)
- 반응형 디자인 및 접근성 속성 적용

### File List

#### 생성된 파일
- `components/auth/SignInForm.tsx` - 로그인 폼 컴포넌트
- `app/login/page.tsx` - 로그인 페이지
- `__tests__/unit/auth/SignInForm.test.tsx` - SignInForm 단위 테스트
- `__tests__/integration/auth/signin.test.ts` - 로그인 통합 테스트

#### 수정된 파일
- `app/actions/auth.ts` - signInWithEmail 함수 추가, 에러 메시지 개선
- `.env.local` - Supabase 프로젝트 업데이트 (ACTIVE_HEALTHY 프로젝트로 전환)

---

## QA Results

_(QA 검토 시 작성)_


