# Story 4.6: 요약/태그 수동 편집 기능

## Status
Draft

---

## Story
**As a** 사용자,
**I want** AI가 생성한 요약과 태그를 수동으로 편집할 수 있도록,
**so that** AI 결과가 만족스럽지 않을 때 직접 수정하여 더 정확한 결과를 얻을 수 있다

---

## Acceptance Criteria
1. 기존 AI 요약을 클릭하여 편집 모드로 전환할 수 있다
2. 기존 AI 태그를 클릭하여 편집 모드로 전환할 수 있다
3. 요약 편집 시 텍스트 에디터가 표시되고 기존 내용이 로드된다
4. 태그 편집 시 개별 태그를 삭제하거나 새로운 태그를 추가할 수 있다
5. 편집 완료 시 변경사항이 즉시 저장된다
6. 편집 취소 시 원래 내용으로 복원된다
7. 편집 중에는 다른 작업이 비활성화된다
8. 편집 완료 후 성공 메시지가 표시된다

---

## Tasks / Subtasks
- [ ] 요약 편집 기능 구현 (AC: 1, 3, 5, 6, 7, 8)
  - [ ] SummaryDisplay에 편집 모드 추가
  - [ ] 인라인 텍스트 에디터 구현
  - [ ] 편집 상태 관리 및 저장 로직
  - [ ] 편집 취소 기능 구현
- [ ] 태그 편집 기능 구현 (AC: 2, 4, 5, 6, 7, 8)
  - [ ] TagDisplay에 편집 모드 추가
  - [ ] 개별 태그 삭제 기능
  - [ ] 새 태그 추가 기능
  - [ ] 편집 상태 관리 및 저장 로직
- [ ] UI/UX 개선 (AC: 7, 8)
  - [ ] 편집 중 비활성화 상태 표시
  - [ ] 편집 완료 성공 메시지
  - [ ] 편집 모드 전환 애니메이션

---

## Dev Notes

### 이전 스토리에서의 인사이트
- Story 4.2 (요약 생성): AI 요약이 항상 완벽하지 않을 수 있음
- Story 4.3 (태그 생성): 태그 품질이 사용자 기대와 다를 수 있음
- Story 4.4 (상태 표시): 편집 중 상태 표시 필요
- Story 4.5 (재생성 기능): 재생성보다 간단한 편집이 더 효율적일 수 있음

### 데이터 모델
- 기존 `summaries` 테이블의 `content` 필드 업데이트
- 기존 `noteTags` 테이블의 태그 추가/삭제
- 편집 히스토리 추적을 위한 필드 고려 (선택사항)

### API 명세
- 새로운 Server Actions 추가:
  - `updateSummary(noteId, content)` - 요약 내용 업데이트
  - `updateTags(noteId, tags)` - 태그 목록 업데이트
  - `addTag(noteId, tag)` - 개별 태그 추가
  - `removeTag(noteId, tag)` - 개별 태그 삭제

### 컴포넌트 명세
- `SummaryDisplay.tsx` 수정:
  - 편집 모드 토글 기능
  - 인라인 텍스트 에디터 (Textarea 또는 ContentEditable)
  - 저장/취소 버튼
- `TagDisplay.tsx` 수정:
  - 편집 모드 토글 기능
  - 개별 태그 삭제 버튼
  - 새 태그 입력 필드
  - 저장/취소 버튼

### 파일 위치
- `app/actions/summaries.ts` - 요약 업데이트 Server Action 추가
- `app/actions/tags.ts` - 태그 업데이트 Server Actions 추가
- `components/notes/SummaryDisplay.tsx` - 편집 기능 추가
- `components/notes/TagDisplay.tsx` - 편집 기능 추가
- `components/ui/inline-editor.tsx` - 인라인 에디터 컴포넌트 (새로 생성)

### 테스트 요구사항
- 편집 모드 전환 테스트
- 요약 편집 및 저장 테스트
- 태그 추가/삭제 테스트
- 편집 취소 기능 테스트
- 사용자 인터랙션 테스트

### 기술적 제약사항
- Next.js App Router 환경에서의 상태 관리
- Server Actions의 비동기 처리
- 실시간 편집 상태 동기화
- 접근성(a11y) 고려한 편집 인터페이스

---

## Testing

### 테스트 파일 위치
- `__tests__/unit/actions/summaries.test.ts` - 요약 업데이트 테스트 추가
- `__tests__/unit/actions/tags.test.ts` - 태그 업데이트 테스트 추가
- `__tests__/unit/components/notes/SummaryDisplay.test.tsx` - 편집 기능 테스트
- `__tests__/unit/components/notes/TagDisplay.test.tsx` - 편집 기능 테스트
- `__tests__/unit/components/ui/inline-editor.test.tsx` - 인라인 에디터 테스트
- `__tests__/integration/manual-editing.test.ts` - 통합 테스트

### 테스트 표준
- Jest + React Testing Library 사용
- 편집 모드 전환 시나리오 테스트
- 사용자 인터랙션 시뮬레이션
- 에러 처리 시나리오 모킹
- 접근성 테스트 포함

### 특정 테스트 요구사항
- 편집 모드 전환 시 UI 변화 확인
- 요약 편집 후 저장 및 취소 동작 확인
- 태그 추가/삭제 후 저장 및 취소 동작 확인
- 편집 중 다른 기능 비활성화 확인
- 편집 완료 후 성공 메시지 표시 확인

---

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-19 | 1.0 | 초기 스토리 문서 생성 | Scrum Master |

---

## Dev Agent Record

### Agent Model Used
*개발 에이전트가 구현 시 기록*

### Debug Log References
*개발 에이전트가 구현 시 기록*

### Completion Notes List
*개발 에이전트가 구현 시 기록*

### File List
*개발 에이전트가 구현 시 기록*

---

## QA Results
*QA 에이전트가 검토 시 기록*
